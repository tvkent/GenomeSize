#!/bin/bash
#SBATCH -p bigmem
#SBATCH --mem=75g
#SBATCH --ntasks=10
#SBATCH --mail-user=tvkent@ucdavis.edu
#SBATCH --mail-type=ALL
#SBATCH -D /home/tvkent/SRA/alignments
#SBATCH -o /home/tvkent/SRA/alignments/bwa3-stdout.txt
#SBATCH -e /home/tvkent/SRA/alignments/bwa3-stderr.txt
#SBATCH -J bwa
set -e
set -u

files=(SRR836342_342-1.CML277.fq.gz SRR836349_349-1.CML247.fq.gz SRR836342_342-1.CML333.fq.gz SRR836349_349-1.CML322.fq.gz SRR836271_B97.fq.gz SRR836342_342-1.Mo17.fq.gz SRR836349_349-1.Il14H.fq.gz SRR836271_CML228.fq.gz SRR836342_342-1.NC358.fq.gz SRR836349_349-1.Ky21.fq.gz SRR836271_CML277.fq.gz SRR836342_342-1.Oh43.fq.gz SRR836349_349-1.MS71.fq.gz SRR836271_CML333.fq.gz SRR836342_342-1.OH7B.fq.gz SRR836349_349-1.TIL08.fq.gz SRR836271_CML52.fq.gz SRR836342_342-1.P39.fq.gz SRR836349_349-1.Tzi8.fq.gz SRR836271_KI11.fq.gz SRR836342_342-1.TIL02.fq.gz SRR836349_349-2.Ki11.fq.gz SRR836272_272-1.CML103.fq.gz SRR836342_342-1.TIL06.fq.gz SRR836349_349-2.Ki3.fq.gz SRR836272_272-1.MS71.fq.gz SRR836342_342-1.TIL15.fq.gz SRR836349_349-2.M37W.fq.gz SRR836272_272-1.Tx303.fq.gz SRR836342_342-2.B97.fq.gz SRR836349_349-2.NC350.fq.gz SRR836272_272-2.Ky21.fq.gz SRR836342_342-2.CML322.fq.gz SRR836349_349-2.TIL03.fq.gz SRR836272_272-2.Mo18W.fq.gz SRR836342_342-2.MS71.fq.gz SRR836349_349-2.TIL11.fq.gz SRR836272_272-3.NC358.fq.gz SRR836342_342-2.TIL08.fq.gz SRR836349_349-2.TIL16.fq.gz SRR836307_307-1.B97.fq.gz SRR836342_342-2.Tzi8.fq.gz SRR836349_349-2.Tx303.fq.gz SRR836307_307-1.CML228.fq.gz SRR836342_342-3.Ki11.fq.gz SRR836349_349-3.CML103.fq.gz SRR836307_307-1.CML277.fq.gz SRR836342_342-3.Ki3.fq.gz SRR836349_349-3.CML228.fq.gz SRR836307_307-1.Ki11.fq.gz SRR836342_342-3.M37W.fq.gz SRR836349_349-3.CML277.fq.gz SRR836307_307-2.CML52.fq.gz SRR836342_342-3.NC350.fq.gz SRR836349_349-3.CML333.fq.gz SRR836307_307-3.CML333.fq.gz SRR836342_342-3.TIL03.fq.gz SRR836349_349-3.Mo17.fq.gz SRR836308_308-1.CML103.fq.gz SRR836342_342-3.TIL11.fq.gz SRR836349_349-3.NC358.fq.gz SRR836308_308-1.MS71.fq.gz SRR836342_342-3.TIL16.fq.gz SRR836349_349-3.Oh43.fq.gz SRR836308_308-1.Tx303.fq.gz SRR836342_342-3.Tx303.fq.gz SRR836349_349-3.OH7B.fq.gz SRR836308_308-2.Ky21.fq.gz SRR836342_342-4.CML52.fq.gz SRR836349_349-3.P39.fq.gz SRR836308_308-2.Mo18W.fq.gz SRR836342_342-4.CML69.fq.gz SRR836349_349-3.TIL02.fq.gz SRR836308_308-3.NC358.fq.gz SRR836342_342-4.HP301.fq.gz SRR836349_349-3.TIL06.fq.gz SRR836309_309-1.HP301.fq.gz SRR836342_342-4.M162W.fq.gz SRR836349_349-3.TIL15.fq.gz SRR836309_309-1.Il14H.fq.gz SRR836342_342-4.Mo18W.fq.gz SRR836349_349-4.CML52.fq.gz SRR836309_309-1.M162W.fq.gz SRR836342_342-4.TIL01.fq.gz SRR836349_349-4.CML69.fq.gz SRR836309_309-1.Mo17.fq.gz SRR836342_342-4.TIL05.fq.gz SRR836349_349-4.HP301.fq.gz SRR836309_309-1.Oh43.fq.gz SRR836342_342-4.TIL14.fq.gz SRR836349_349-4.M162W.fq.gz SRR836309_309-1.P39.fq.gz SRR836342_342-5.B73.fq.gz SRR836349_349-4.Mo18W.fq.gz SRR836309_309-2.B73.fq.gz SRR836342_342-5.CML247.fq.gz SRR836349_349-4.TIL01.fq.gz SRR836309_309-2.CML69.fq.gz SRR836342_342-5.Il14H.fq.gz SRR836349_349-4.TIL05.fq.gz SRR836309_309-2.NC350.fq.gz SRR836342_342-5.Ky21.fq.gz SRR836349_349-4.TIL14.fq.gz SRR836309_309-3.CML247.fq.gz SRR836345_345-1.B73.fq.gz SRR836350_350-1.B73.fq.gz SRR836309_309-3.OH7B.fq.gz SRR836345_345-1.B97.fq.gz SRR836350_350-1.B97.fq.gz SRR836309_309-3.Tzi8.fq.gz SRR836345_345-1.CML247.fq.gz SRR836350_350-1.CML247.fq.gz SRR836309_309-4.CML322.fq.gz SRR836345_345-1.CML322.fq.gz SRR836350_350-1.CML322.fq.gz SRR836309_309-4.M37W.fq.gz SRR836345_345-1.Il14H.fq.gz SRR836350_350-1.Il14H.fq.gz SRR836309_309-5.CML69.fq.gz SRR836345_345-1.Ky21.fq.gz SRR836350_350-1.Ky21.fq.gz SRR836309_309-6.Ki3.fq.gz SRR836345_345-1.MS71.fq.gz SRR836350_350-1.MS71.fq.gz SRR836310_310-1.IL14H.fq.gz SRR836345_345-1.TIL08.fq.gz SRR836350_350-1.TIL08.fq.gz SRR836310_310-1.Tx303.fq.gz SRR836345_345-1.Tzi8.fq.gz SRR836350_350-1.Tzi8.fq.gz SRR836310_310-2.B73.fq.gz SRR836345_345-2.CML52.fq.gz SRR836350_350-2.Ki11.fq.gz SRR836312.B73.fq.gz SRR836345_345-2.CML69.fq.gz SRR836350_350-2.Ki3.fq.gz SRR836313.B73.fq.gz SRR836345_345-2.HP301.fq.gz SRR836350_350-2.M37W.fq.gz SRR836314.B73.fq.gz SRR836345_345-2.M162W.fq.gz SRR836350_350-2.NC350.fq.gz SRR836316.B73.fq.gz SRR836345_345-2.Mo18W.fq.gz SRR836350_350-2.TIL03.fq.gz SRR836317.B73.fq.gz SRR836345_345-2.TIL01.fq.gz SRR836350_350-2.TIL11.fq.gz SRR836317.Ki11.fq.gz SRR836345_345-2.TIL05.fq.gz SRR836350_350-2.TIL16.fq.gz SRR836318.B73.fq.gz SRR836345_345-2.TIL14.fq.gz SRR836350_350-2.Tx303.fq.gz SRR836319.B73.fq.gz SRR836345_345-3.Ki11.fq.gz SRR836350_350-3.CML103.fq.gz SRR836320.B73.fq.gz SRR836345_345-3.Ki3.fq.gz SRR836350_350-3.CML228.fq.gz SRR836322.B73.fq.gz SRR836345_345-3.M37W.fq.gz SRR836350_350-3.CML277.fq.gz SRR836323.B73.fq.gz SRR836345_345-3.NC350.fq.gz SRR836350_350-3.CML333.fq.gz SRR836324.B73.fq.gz SRR836345_345-3.TIL03.fq.gz SRR836350_350-3.Mo17.fq.gz SRR836326.B73.fq.gz SRR836345_345-3.TIL11.fq.gz SRR836350_350-3.NC358.fq.gz SRR836328.B73.fq.gz SRR836345_345-3.TIL16.fq.gz SRR836350_350-3.Oh43.fq.gz SRR836329.B73.fq.gz SRR836345_345-3.Tx303.fq.gz SRR836350_350-3.OH7B.fq.gz SRR836330.B73.fq.gz SRR836345_345-4.CML103.fq.gz SRR836350_350-3.P39.fq.gz SRR836331.B73.fq.gz SRR836345_345-4.CML228.fq.gz SRR836350_350-3.TIL02.fq.gz SRR836332.B73.fq.gz SRR836345_345-4.CML277.fq.gz SRR836350_350-3.TIL06.fq.gz SRR836333.B73.fq.gz SRR836345_345-4.CML333.fq.gz SRR836350_350-3.TIL15.fq.gz SRR836334.B73.fq.gz SRR836345_345-4.Mo17.fq.gz SRR836350_350-4.CML52.fq.gz SRR836335.B73.fq.gz SRR836345_345-4.NC358.fq.gz SRR836350_350-4.CML69.fq.gz SRR836336.B73.fq.gz SRR836345_345-4.Oh43.fq.gz SRR836350_350-4.HP301.fq.gz SRR836337.B73.fq.gz SRR836345_345-4.OH7B.fq.gz SRR836350_350-4.M162W.fq.gz SRR836338.B73.fq.gz SRR836345_345-4.P39.fq.gz SRR836350_350-4.Mo18W.fq.gz SRR836339.B73.fq.gz SRR836345_345-4.TIL02.fq.gz SRR836350_350-4.TIL01.fq.gz SRR836340.B73.fq.gz SRR836345_345-4.TIL06.fq.gz SRR836350_350-4.TIL05.fq.gz SRR836341.B73.fq.gz SRR836345_345-4.TIL15.fq.gz SRR836350_350-4.TIL14.fq.gz SRR836342_342-1.CML103.fq.gz SRR836349_349-1.B73.fq.gz SRR836342_342-1.CML228.fq.gz SRR836349_349-1.B97.fq.gz)

for file in "${files[@]}"
do

../bwa/bwa mem ../Zea_mays.AGPv3.22.cdna.T01.fa $file > $file.T01.sam

##sam to bam
samtools view -bS $file.T01.sam | samtools sort - $(echo $file.T01).sorted

##removing duplicated reads
samtools rmdup -s $file.T01.sorted.bam $file.T01.sorted.rmdup.bam

##Calculating total number of unique reads
n_reads=$(samtools view $file.T01.sorted.bam | cut -f 1 | sort | uniq | wc -l)

##Calculating total number of unique reads mapping
n_mapping=$(samtools view $file.T01.sorted.bam | cut -f 1,3 | grep -v '*' | cut -f 1 | sort | uniq | wc -l)


##Removing created files
rm $file.T*

##Calculating percentage
percentage=$(echo 'scale=4;' $n_mapping/$n_reads | bc -l)

#Printing output
echo barcode$'\t'$file$'\t'$n_reads$'\t'$n_mapping$'\t'$percentage

done
